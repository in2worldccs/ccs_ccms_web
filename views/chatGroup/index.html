<!DOCTYPE html>
<html>
<head>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="x-ua-compatible" content="ie=edge">


        <!-- Font Awesome Icons -->
        <link rel="stylesheet" href="AdminLTE/plugins/fontawesome-free/css/all.min.css">
        <!-- overlayScrollbars -->
        <link rel="stylesheet" href="AdminLTE/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
        <!-- Theme style -->
        <link rel="stylesheet" href="AdminLTE/dist/css/adminlte.min.css">
        <!-- Google Font: Source Sans Pro -->
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="AdminLTE/plugins/fontawesome-free/css/all.min.css">
        <!-- Ionicons -->
        <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
        <!-- daterange picker -->
        <link rel="stylesheet" href="AdminLTE/plugins/daterangepicker/daterangepicker.css">
        <!-- iCheck for checkboxes and radio inputs -->
        <link rel="stylesheet" href="AdminLTE/plugins/icheck-bootstrap/icheck-bootstrap.min.css">
        <!-- Bootstrap Color Picker -->
        <link rel="stylesheet" href="AdminLTE/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css">
        <!-- Tempusdominus Bbootstrap 4 -->
        <link rel="stylesheet" href="AdminLTE/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
        <!-- Select2 -->
        <link rel="stylesheet" href="AdminLTE/plugins/select2/css/select2.min.css">
        <link rel="stylesheet" href="AdminLTE/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css">
        <!-- Bootstrap4 Duallistbox -->
        <link rel="stylesheet" href="AdminLTE/plugins/bootstrap4-duallistbox/bootstrap-duallistbox.min.css">

        <!-- Google Font: Source Sans Pro -->
        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

        <title>CCSystem | Chat Group</title>


    <link href="/style.css" rel="stylesheet" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js" type="text/javascript"></script>
    <script src="/data.js" type="text/javascript"></script>
</head>

<body class="hold-transition sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">
        <div class="wrapper">
            <!-- Navbar -->
            <nav class="main-header navbar navbar-expand navbar-white navbar-light">
                <!-- Left navbar links -->
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" data-widget="pushmenu" href="#">
                            <i class="fas fa-bars"></i>
                        </a>
                    </li>

                </ul>
            </nav>
            <!-- /.navbar -->

            <!-- Main Sidebar Container -->
            <aside class="main-sidebar sidebar-dark-primary elevation-4">
                <!-- Brand Logo -->
                <a href="" class="brand-link">
                    <img src="AdminLTE/dist/img/AdminLTELogo.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: .8">
                    <span class="brand-text font-weight-light">CCSystem</span>
                </a>

                <!-- Sidebar -->
                <div class="sidebar">
                    <!-- Sidebar user panel (optional) -->
                    <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                        <div class="image">
                            <img src="AdminLTE/dist/img/user2-160x160.jpg" class="img-circle elevation-2" alt="User Image">
                        </div>
                        <div class="info">
                            <a href="#" class="d-block">Alexander Pierce</a>
                        </div>
                    </div>

                    <!-- Sidebar Menu -->
                    <nav class="mt-2">
                        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">

                            <li class="nav-item">
                                <a href="/users" class="nav-link">
                                    <i class="nav-icon far fa-user"></i>
                                    <p>users </p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/groups" class="nav-link">
                                    <i class="nav-icon fas fa-users"></i>
                                    <p>groups </p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/group-users" class="nav-link">
                                    <i class="nav-icon fas fa-users"></i>
                                    <p>Group Users</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/chat-user" class="nav-link">
                                    <i class="nav-icon fas fa-comments"></i>
                                    <p>Chat User </p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/chat-group" class="nav-link">
                                    <i class="nav-icon fas fa-comments"></i>
                                    <p>Chat Group </p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/logout" class="nav-link">
                                    <i class="nav-icon fas fa-sign-out-alt"></i>
                                    <p>logout </p>
                                </a>
                            </li>

                        </ul>
                    </nav>
                    <!-- /.sidebar-menu -->
                </div>
                <!-- /.sidebar -->
            </aside>

<h2>Chat Messages Group</h2>
<hr>


                        </div>
                        <!-- /.row -->
                    </div>
                    <!-- /.container-fluid -->
                </div>
                <!-- /.content-header -->
                <h3>Groups</h3>

                <section class="content">
                    <div class="card">
                        <!-- /.card-header -->
                        <div class="card-body p-0">
                            <div id="list_group" class="table-responsive">
                            </div>
                        </div>
                    </div>
                </section>

                <section class="content">
                    <div class="card">
                        <!-- /.card-header -->
                        <div class="card-body p-0">
                            <div id="chatGroup" class="table-responsive">
                            </div>
                        </div>
                    </div>
                </section>







                <section class="content">


                                <input id="sender_id" type="hidden">
                                <input id="receiver_id" type="hidden">

                                <div class="form-group">
                                    <label for="sender">sender</label>
                                    <input id="sender" name="sender" placeholder="sender" readonly type="text" class="form-control">
                                </div>

                                <div class="form-group">
                                    <label for="receiver">group</label>
                                    <input id="receiver" placeholder="group" type="text" readonly class="form-control">
                                </div>

                                <div class="form-group">
                                    <label for="messages">messages</label>

                                    <textarea cols="50" id="messages" placeholder="Enter the messages..." rows="4" class="form-control"></textarea>
                                </div>


                                <div class="row">
                                        <button id="send" class="btn btn-primary btn-block" >Send</button>

                                    </div>



                                <div id="boradcast"></div>

                            </section>



                <!-- Main Footer -->
                <footer class="main-footer">
                    <strong>Copyright &copy; 2014-2019
                        <a href="">eutd</a>.</strong>
                    All rights reserved.
                    <div class="float-right d-none d-sm-inline-block">
                        <b>Version</b> -1
                    </div>
                </footer>
            </div>
            <!-- ./wrapper -->

            <!-- REQUIRED SCRIPTS -->
            <!-- jQuery -->
            <script src="AdminLTE/plugins/jquery/jquery.min.js"></script>
            <!-- Bootstrap -->
            <script src="AdminLTE/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
            <!-- overlayScrollbars -->
            <script src="AdminLTE/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
            <!-- AdminLTE App -->
            <script src="AdminLTE/dist/js/adminlte.js"></script>

            <!-- OPTIONAL SCRIPTS -->
            <script src="AdminLTE/dist/js/demo.js"></script>

            <!-- PAGE PLUGINS -->
            <!-- jQuery Mapael -->
            <script src="AdminLTE/plugins/jquery-mousewheel/jquery.mousewheel.js"></script>
            <script src="AdminLTE/plugins/raphael/raphael.min.js"></script>
            <script src="AdminLTE/plugins/jquery-mapael/jquery.mapael.min.js"></script>
            <script src="AdminLTE/plugins/jquery-mapael/maps/usa_states.min.js"></script>
            <!-- ChartJS -->
            <script src="AdminLTE/plugins/chart.js/Chart.min.js"></script>

            <!-- PAGE SCRIPTS -->
            <script src="AdminLTE/dist/js/pages/dashboard2.js"></script>






<!--
<script type="text/javascript" src="/client.js"></script>
-->
<script>
    list_group();

    function list_group() {
        var url = stageBaseURLs + '/group-users/groups/' + getCookie().user.id;
        $.ajax({
            url: url,
            data: {},
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                var i = 0;
                var ul = '<ul>';
                if (data.result == 1) {
                    $.each(data.data, function (idx, obj) {
                        $.each(obj, function (i, v) {
                            ul += ('<li onclick="getChatGroup(\'' + v.groups_user.group_name + '\',\'' + v.groups_user.group_id + '\')"> <a href="javascript:;" >' + v.groups_user.group_name + '</a></li>');

                        });
                        ul += ('</ul>');
                        $("#list_group").html(ul);
                    });
                }
            },
        });

    }


    function getCookie() {
        var strCookie = decodeURIComponent(JSON.stringify(document.cookie));
        var cookieArr = strCookie.split("=");
        var cookieArr1 = cookieArr[1].split("j:");
        var cookieString = cookieArr1[1].slice(0, -1);
        return JSON.parse(cookieString);
    }


    function getChatGroup(name, id) {
        document.getElementById('receiver').value = name;
        document.getElementById('receiver_id').value = id;
        document.getElementById('chatGroup').innerHTML = '';
    }

    document.getElementById('sender').value = getCookie().user.username;
    document.getElementById('sender_id').value = getCookie().user.id;


    var scoket = io.connect('https://ibrahemayyad.ga:3007');

    var sender = document.getElementById('sender');
    var sender_id = document.getElementById('sender_id');
    var receiver = document.getElementById('receiver');
    var receiver_id = document.getElementById('receiver_id');
    var message = document.getElementById('messages');
    var send = document.getElementById('send');
    var chat = document.getElementById('chatGroup');
    var brodcast = document.getElementById('boradcast');


    //Reception data from server
    scoket.emit('auth', {
        senderID: getCookie().user.id
    });


    //send data to server
    send.addEventListener('click', function () {
        scoket.emit('group_chat', {
            senderID: getCookie().user.id,
            senderUsername: getCookie().user.username,
            receiver: receiver.value,
            receiverID: receiver_id.value,
            message: message.value,
        });

        chat.innerHTML += '<div class="container" style="background-color: #ccc; text-align: right;">' +
            '<span>' + message.value + ':</span>' +
            '<strong>' + sender.value + '</strong>' +
            '</div>';
    });


    //Reception data from server
    scoket.on('new_msg_group_chat', function (data) {
        if(data.receiverID == receiver_id.value ) {
            brodcast.innerHTML = '';
            chat.innerHTML += '<div class="container">' +
                '<strong>' + data.senderUsername + ':</strong>' +
                data.message +
                '</div>';
        }
    });

    /*   //
       message.addEventListener('keydown', function () {
           scoket.emit('borad', {
               username: sender.value,
           });
       });*/

    /* scoket.on('new_brodcast', function (data) {
         brodcast.innerHTML = '<strong>' + data.username + ': </strong>' +
             'writing a message <img src="/writ.gif" style="width: 40px; height: 40px; margin-bottom:-15px;">';
     });*/

</script>
</body>
</html>
