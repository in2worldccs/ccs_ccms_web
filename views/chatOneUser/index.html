<!DOCTYPE html>
<html>

<head>


    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta content="ie=edge" http-equiv="x-ua-compatible">


    <!-- Font Awesome Icons -->
    <link href="AdminLTE/plugins/fontawesome-free/css/all.min.css" rel="stylesheet">
    <!-- overlayScrollbars -->
    <link href="AdminLTE/plugins/overlayScrollbars/css/OverlayScrollbars.min.css" rel="stylesheet">
    <!-- Theme style -->
    <link href="AdminLTE/dist/css/adminlte.min.css" rel="stylesheet">
    <!-- Google Font: Source Sans Pro -->
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <!-- Font Awesome -->
    <link href="AdminLTE/plugins/fontawesome-free/css/all.min.css" rel="stylesheet">
    <!-- Ionicons -->
    <link href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet">
    <!-- daterange picker -->
    <link href="AdminLTE/plugins/daterangepicker/daterangepicker.css" rel="stylesheet">
    <!-- iCheck for checkboxes and radio inputs -->
    <link href="AdminLTE/plugins/icheck-bootstrap/icheck-bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Color Picker -->
    <link href="AdminLTE/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css" rel="stylesheet">
    <!-- Tempusdominus Bbootstrap 4 -->
    <link href="AdminLTE/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet">
    <!-- Select2 -->
    <link href="AdminLTE/plugins/select2/css/select2.min.css" rel="stylesheet">
    <link href="AdminLTE/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css" rel="stylesheet">
    <!-- Bootstrap4 Duallistbox -->
    <link href="AdminLTE/plugins/bootstrap4-duallistbox/bootstrap-duallistbox.min.css" rel="stylesheet">

    <!-- Google Font: Source Sans Pro -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">


    <title>CCSystem | Chat User</title>
    <link href="/style.css" rel="stylesheet" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js" type="text/javascript"></script>
    <script src="/data.js" type="text/javascript"></script>
</head>


<body class="hold-transition sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">
<div class="wrapper">
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
        <!-- Left navbar links -->
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" data-widget="pushmenu" href="#">
                    <i class="fas fa-bars"></i>
                </a>
            </li>

        </ul>
    </nav>
    <!-- /.navbar -->

    <!-- Main Sidebar Container -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">
        <!-- Brand Logo -->
        <a class="brand-link" href="">
            <img alt="AdminLTE Logo" class="brand-image img-circle elevation-3" src="AdminLTE/dist/img/AdminLTELogo.png"
                 style="opacity: .8">
            <span class="brand-text font-weight-light">CCSystem</span>
        </a>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Sidebar user panel (optional) -->
            <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                <div class="image">
                    <img alt="User Image" class="img-circle elevation-2" src="AdminLTE/dist/img/user2-160x160.jpg">
                </div>
                <div class="info">
                    <a class="d-block" href="#">Alexander Pierce</a>
                </div>
            </div>

            <!-- Sidebar Menu -->
            <nav class="mt-2">
                <ul class="nav nav-pills nav-sidebar flex-column" data-accordion="false" data-widget="treeview"
                    role="menu">

                    <li class="nav-item">
                        <a class="nav-link" href="/users">
                            <i class="nav-icon far fa-user"></i>
                            <p>users </p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/groups">
                            <i class="nav-icon fas fa-users"></i>
                            <p>groups </p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/group-users">
                            <i class="nav-icon fas fa-users"></i>
                            <p>Group Users</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/chat-user">
                            <i class="nav-icon fas fa-comments"></i>
                            <p>Chat User </p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/chat-group">
                            <i class="nav-icon fas fa-comments"></i>
                            <p>Chat Group </p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/logout">
                            <i class="nav-icon fas fa-sign-out-alt"></i>
                            <p>logout </p>
                        </a>
                    </li>

                </ul>
            </nav>
            <!-- /.sidebar-menu -->
        </div>
        <!-- /.sidebar -->
    </aside>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <div class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-8">
                        <h1 class="m-0 text-dark">Chat Messages one user</h1>
                    </div>
                    <!-- /.col -->


                </div>
                <!-- /.row -->
            </div>
            <!-- /.container-fluid -->
        </div>
        <!-- /.content-header -->
        <h3>Users</h3>

        <section class="content">
            <div class="card">
                <!-- /.card-header -->
                <div class="card-body p-0">
                    <div class="table-responsive" id="list_users">
                    </div>
                </div>
            </div>
        </section>

        <section class="content">
            <div class="card">
                <!-- /.card-header -->
                <div class="card-body p-0">
                    <div class="table-responsive" id="chatOneUser">
                    </div>
                </div>
            </div>
        </section>


        <section class="content">


            <input id="sender_id" type="hidden">
            <input id="receiver_id" type="hidden">

            <div class="form-group">
                <label for="sender">sender</label>
                <input class="form-control" id="sender" name="sender" placeholder="sender" readonly type="text">
            </div>

            <div class="form-group">
                <label for="receiver">receiver</label>
                <input class="form-control" id="receiver" placeholder="receiver" readonly type="text">
            </div>

            <div class="form-group">
                <label for="messages">messages</label>

                <textarea class="form-control" cols="50" id="messages" placeholder="Enter the messages..."
                          rows="4"></textarea>
            </div>


            <div class="row">
                <button class="btn btn-primary btn-block" id="send">Send</button>

            </div>


            <div id="boradcast"></div>

        </section>


        <!-- Main Footer -->
        <footer class="main-footer">
            <strong>Copyright &copy; 2014-2019
                <a href="">eutd</a>.</strong>
            All rights reserved.
            <div class="float-right d-none d-sm-inline-block">
                <b>Version</b> -1
            </div>
        </footer>
    </div>
</div>
<!-- ./wrapper -->

<!-- REQUIRED SCRIPTS -->
<!-- jQuery -->
<script src="AdminLTE/plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="AdminLTE/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- overlayScrollbars -->
<script src="AdminLTE/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
<!-- AdminLTE App -->
<script src="AdminLTE/dist/js/adminlte.js"></script>

<!-- OPTIONAL SCRIPTS -->
<script src="AdminLTE/dist/js/demo.js"></script>

<!-- PAGE PLUGINS -->
<!-- jQuery Mapael -->
<script src="AdminLTE/plugins/jquery-mousewheel/jquery.mousewheel.js"></script>
<script src="AdminLTE/plugins/raphael/raphael.min.js"></script>
<script src="AdminLTE/plugins/jquery-mapael/jquery.mapael.min.js"></script>
<script src="AdminLTE/plugins/jquery-mapael/maps/usa_states.min.js"></script>
<!-- ChartJS -->
<script src="AdminLTE/plugins/chart.js/Chart.min.js"></script>

<!-- PAGE SCRIPTS -->
<script src="AdminLTE/dist/js/pages/dashboard2.js"></script>


<!-- <strong>writing a message</strong>
<img src="/writ.gif" style="width: 40px; height: 40px; margin-bottom:-15px;"> -->

<!--
<script type="text/javascript" src="/client.js"></script>
-->
<script>
    list_users();

    function list_users() {
        var url = stageBaseURLs + '/users/data';
        $.ajax({
            url: url,
            data: {},
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                var i = 0;
                var ul = '<ul>';
                if (data.result == 1) {
                    $.each(data.data, function (idx, obj) {
                        $.each(obj, function (i, v) {
                            var username = v.username;
                            var id = v.id;
                            ul += ('<li onclick="getChat(\'' + username + '\',\'' + id + '\')"> <a href="javascript:;" >' + v.username + '</a></li>');
                        });
                    });
                    ul += ('</ul>');
                    $("#list_users").html(ul);
                }
            },
        });
    }

    function getChat(name, id) {
        //console.log(name, id);
        document.getElementById('receiver').value = name;
        document.getElementById('receiver_id').value = id;
        document.getElementById('chatOneUser').innerHTML = '';

    }

    function getCookie() {
        var strCookie = decodeURIComponent(JSON.stringify(document.cookie));
        var cookieArr = strCookie.split("=");
        var cookieArr1 = cookieArr[1].split("j:");
        var cookieString = cookieArr1[1].slice(0, -1);
        return JSON.parse(cookieString);
    }

    function getUsernameFromId(id) {
        /*var url = stageBaseURLs+'/users/data';
        $.ajax({
            url: url,
            data: {},
            type: 'GET',
            dataType: 'json',
            success: function (data) {

            },
        });*/
        return id;
    }

    document.getElementById('sender').value = getCookie().user.username;
    document.getElementById('sender_id').value = getCookie().user.id;


    var scoket = io.connect('https://swifthelp.org:3007');


    var sender = document.getElementById('sender');
    var sender_id = document.getElementById('sender_id');
    var receiver = document.getElementById('receiver');
    var receiver_id = document.getElementById('receiver_id');
    var message = document.getElementById('messages');
    var send = document.getElementById('send');
    var chat = document.getElementById('chatOneUser');
    var brodcast = document.getElementById('boradcast');

    //Reception data from server
    scoket.emit('auth', {
        senderID: getCookie().user.id
    });


    //send data to server
    send.addEventListener('click', function () {
        scoket.emit('user_chat', {
            senderID: getCookie().user.id,
            senderUsername: getCookie().user.username,
            receiverID: receiver_id.value,
            receiverUsername: receiver.value,
            message: message.value,
        });

        chat.innerHTML += '<div class="container" style="background-color: #ccc; text-align: right;">' +
            '<span>' + message.value + ':</span>' +
            '<strong>' + sender.value + '</strong>' +
            '</div>';
    });


    //Reception data from server
    scoket.on('new_msg_user_chat', function (data) {
        console.log(data.senderID);
        console.log(receiver_id);
        if (data.senderID == receiver_id.value) {
            brodcast.innerHTML = '';
            chat.innerHTML += '<div class="container">' +
                '<strong>' + getUsernameFromId(data.senderUsername) + ':</strong>' +
                data.message +
                '</div>';
        }

    });


    //send username is typing ....
    /*   message.addEventListener('keydown', function () {
           scoket.emit('borad', {
               username: username.value,
           });
       });*/

    /*    scoket.on('new_brodcast', function (data) {
            brodcast.innerHTML = '<strong>' + data.username + ': </strong>' +
                'writing a message <img src="/writ.gif" style="width: 40px; height: 40px; margin-bottom:-15px;">';
        });*/


</script>
</body>

</html>
